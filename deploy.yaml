---
# The group k8s-endpoint refer to the nodes that have access to the kubernetes api
# Its is possible to run from localhost accessing a remote node by defining a kubeconfig file
- hosts: k8s-endpoint[0]
  gather_facts: true
  any_errors_fatal: true
  roles:
    - role: k8s-api-bootstrap
      tags:
        - api-bootstrap

# Prepare the base for deploying dojot
- hosts: k8s-endpoint[0]
  any_errors_fatal: true
  roles:
    - role: dojot-basic
      tags:
        - dojot-basic

# Deploy postgreSQL to the environment
# TODO: Add possibility of using an external postgres
# TODO: Support both a simple postgreSQL and a HA cluster
- hosts: k8s-endpoint[0]
  any_errors_fatal: true
  roles:
    - role: databases/postgresql
      tags:
        - dojot-dbs
        - dojot-psql